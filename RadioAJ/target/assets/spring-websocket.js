var JSON;JSON||(JSON={}),function(){function str(a,b){var c,d,e,f,h,g=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,h=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)h[c]=str(c,i)||"null";return e=0===h.length?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));return e=0===h.length?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e}}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(a){return 10>a?"0"+a:a}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,!b||"function"==typeof b||"object"==typeof b&&"number"==typeof b.length)return str("",{"":a});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var _document=document,_window=window,utils={},REventTarget=function(){};REventTarget.prototype.addEventListener=function(eventType,listener){this._listeners||(this._listeners={}),eventType in this._listeners||(this._listeners[eventType]=[]);var arr=this._listeners[eventType];-1===utils.arrIndexOf(arr,listener)&&arr.push(listener)},REventTarget.prototype.removeEventListener=function(eventType,listener){if(this._listeners&&eventType in this._listeners){var arr=this._listeners[eventType],idx=utils.arrIndexOf(arr,listener);return-1!==idx?void(arr.length>1?this._listeners[eventType]=arr.slice(0,idx).concat(arr.slice(idx+1)):delete this._listeners[eventType]):void 0}},REventTarget.prototype.dispatchEvent=function(event){var t=event.type,args=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,args),this._listeners&&t in this._listeners)for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].apply(this,args)};var SimpleEvent=function(type,obj){if(this.type=type,"undefined"!=typeof obj)for(var k in obj)obj.hasOwnProperty(k)&&(this[k]=obj[k])};SimpleEvent.prototype.toString=function(){var r=[];for(var k in this)if(this.hasOwnProperty(k)){var v=this[k];"function"==typeof v&&(v="[function]"),r.push(k+"="+v)}return"SimpleEvent("+r.join(", ")+")"};var EventEmitter=function(events){var that=this;that._events=events||[],that._listeners={}};EventEmitter.prototype.emit=function(type){var that=this;if(that._verifyType(type),!that._nuked){var args=Array.prototype.slice.call(arguments,1);if(that["on"+type]&&that["on"+type].apply(that,args),type in that._listeners)for(var i=0;i<that._listeners[type].length;i++)that._listeners[type][i].apply(that,args)}},EventEmitter.prototype.on=function(type,callback){var that=this;that._verifyType(type),that._nuked||(type in that._listeners||(that._listeners[type]=[]),that._listeners[type].push(callback))},EventEmitter.prototype._verifyType=function(type){var that=this;-1===utils.arrIndexOf(that._events,type)&&utils.log("Event "+JSON.stringify(type)+" not listed "+JSON.stringify(that._events)+" in "+that)},EventEmitter.prototype.nuke=function(){var that=this;that._nuked=!0;for(var i=0;i<that._events.length;i++)delete that[that._events[i]];that._listeners={}};var random_string_chars="abcdefghijklmnopqrstuvwxyz0123456789_";utils.random_string=function(length,max){max=max||random_string_chars.length;var i,ret=[];for(i=0;length>i;i++)ret.push(random_string_chars.substr(Math.floor(Math.random()*max),1));return ret.join("")},utils.random_number=function(max){return Math.floor(Math.random()*max)},utils.random_number_string=function(max){var t=(""+(max-1)).length,p=Array(t+1).join("0");return(p+utils.random_number(max)).slice(-t)},utils.getOrigin=function(url){url+="/";var parts=url.split("/").slice(0,3);return parts.join("/")},utils.isSameOriginUrl=function(url_a,url_b){return url_b||(url_b=_window.location.href),url_a.split("/").slice(0,3).join("/")===url_b.split("/").slice(0,3).join("/")},utils.getParentDomain=function(url){if(/^[0-9.]*$/.test(url))return url;if(/^\[/.test(url))return url;if(!/[.]/.test(url))return url;var parts=url.split(".").slice(1);return parts.join(".")},utils.objectExtend=function(dst,src){for(var k in src)src.hasOwnProperty(k)&&(dst[k]=src[k]);return dst};var WPrefix="_jp";utils.polluteGlobalNamespace=function(){WPrefix in _window||(_window[WPrefix]={})},utils.closeFrame=function(code,reason){return"c"+JSON.stringify([code,reason])},utils.userSetCode=function(code){return 1e3===code||code>=3e3&&4999>=code},utils.countRTO=function(rtt){var rto;return rto=rtt>100?3*rtt:rtt+200},utils.log=function(){_window.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},utils.bind=function(fun,that){return fun.bind?fun.bind(that):function(){return fun.apply(that,arguments)}},utils.flatUrl=function(url){return-1===url.indexOf("?")&&-1===url.indexOf("#")},utils.amendUrl=function(url){var dl=_document.location;if(!url)throw new Error("Wrong url for SockJS");if(!utils.flatUrl(url))throw new Error("Only basic urls are supported in SockJS");return 0===url.indexOf("//")&&(url=dl.protocol+url),0===url.indexOf("/")&&(url=dl.protocol+"//"+dl.host+url),url=url.replace(/[\/]+$/,"")},utils.arrIndexOf=function(arr,obj){for(var i=0;i<arr.length;i++)if(arr[i]===obj)return i;return-1},utils.arrSkip=function(arr,obj){var idx=utils.arrIndexOf(arr,obj);if(-1===idx)return arr.slice();var dst=arr.slice(0,idx);return dst.concat(arr.slice(idx+1))},utils.isArray=Array.isArray||function(value){return{}.toString.call(value).indexOf("Array")>=0},utils.delay=function(t,fun){return"function"==typeof t&&(fun=t,t=0),setTimeout(fun,t)};var extra_lookup,json_escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,json_lookup={"\x00":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","	":"\\t","\n":"\\n","":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","﻿":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},extra_escapable=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,JSONQuote=JSON&&JSON.stringify||function(string){return json_escapable.lastIndex=0,json_escapable.test(string)&&(string=string.replace(json_escapable,function(a){return json_lookup[a]})),'"'+string+'"'},unroll_lookup=function(escapable){var i,unrolled={},c=[];for(i=0;65536>i;i++)c.push(String.fromCharCode(i));return escapable.lastIndex=0,c.join("").replace(escapable,function(a){return unrolled[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4),""}),escapable.lastIndex=0,unrolled};utils.quote=function(string){var quoted=JSONQuote(string);return extra_escapable.lastIndex=0,extra_escapable.test(quoted)?(extra_lookup||(extra_lookup=unroll_lookup(extra_escapable)),quoted.replace(extra_escapable,function(a){return extra_lookup[a]})):quoted};var _all_protocols=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];utils.probeProtocols=function(){for(var probed={},i=0;i<_all_protocols.length;i++){var protocol=_all_protocols[i];probed[protocol]=SockJS[protocol]&&SockJS[protocol].enabled()}return probed},utils.detectProtocols=function(probed,protocols_whitelist,info){var pe={},protocols=[];protocols_whitelist||(protocols_whitelist=_all_protocols);for(var i=0;i<protocols_whitelist.length;i++){var protocol=protocols_whitelist[i];pe[protocol]=probed[protocol]}var maybe_push=function(protos){var proto=protos.shift();pe[proto]?protocols.push(proto):protos.length>0&&maybe_push(protos)};return info.websocket!==!1&&maybe_push(["websocket"]),pe["xhr-streaming"]&&!info.null_origin?protocols.push("xhr-streaming"):!pe["xdr-streaming"]||info.cookie_needed||info.null_origin?maybe_push(["iframe-eventsource","iframe-htmlfile"]):protocols.push("xdr-streaming"),pe["xhr-polling"]&&!info.null_origin?protocols.push("xhr-polling"):!pe["xdr-polling"]||info.cookie_needed||info.null_origin?maybe_push(["iframe-xhr-polling","jsonp-polling"]):protocols.push("xdr-polling"),protocols};var MPrefix="_sockjs_global";utils.createHook=function(){var window_id="a"+utils.random_string(8);if(!(MPrefix in _window)){var map={};_window[MPrefix]=function(window_id){return window_id in map||(map[window_id]={id:window_id,del:function(){delete map[window_id]}}),map[window_id]}}return _window[MPrefix](window_id)},utils.attachMessage=function(listener){utils.attachEvent("message",listener)},utils.attachEvent=function(event,listener){"undefined"!=typeof _window.addEventListener?_window.addEventListener(event,listener,!1):(_document.attachEvent("on"+event,listener),_window.attachEvent("on"+event,listener))},utils.detachMessage=function(listener){utils.detachEvent("message",listener)},utils.detachEvent=function(event,listener){"undefined"!=typeof _window.addEventListener?_window.removeEventListener(event,listener,!1):(_document.detachEvent("on"+event,listener),_window.detachEvent("on"+event,listener))};var on_unload={},after_unload=!1,trigger_unload_callbacks=function(){for(var ref in on_unload)on_unload[ref](),delete on_unload[ref]},unload_triggered=function(){after_unload||(after_unload=!0,trigger_unload_callbacks())};utils.attachEvent("unload",unload_triggered),utils.unload_add=function(listener){var ref=utils.random_string(8);return on_unload[ref]=listener,after_unload&&utils.delay(trigger_unload_callbacks),ref},utils.unload_del=function(ref){ref in on_unload&&delete on_unload[ref]},utils.createIframe=function(iframe_url,error_callback){var tref,unload_ref,iframe=_document.createElement("iframe"),unattach=function(){clearTimeout(tref);try{iframe.onload=null}catch(x){}iframe.onerror=null},cleanup=function(){iframe&&(unattach(),setTimeout(function(){iframe&&iframe.parentNode.removeChild(iframe),iframe=null},0),utils.unload_del(unload_ref))},onerror=function(r){iframe&&(cleanup(),error_callback(r))},post=function(msg,origin){try{iframe&&iframe.contentWindow&&iframe.contentWindow.postMessage(msg,origin)}catch(x){}};return iframe.src=iframe_url,iframe.style.display="none",iframe.style.position="absolute",iframe.onerror=function(){onerror("onerror")},iframe.onload=function(){clearTimeout(tref),tref=setTimeout(function(){onerror("onload timeout")},2e3)},_document.body.appendChild(iframe),tref=setTimeout(function(){onerror("timeout")},15e3),unload_ref=utils.unload_add(cleanup),{post:post,cleanup:cleanup,loaded:unattach}},utils.createHtmlfile=function(iframe_url,error_callback){var tref,unload_ref,iframe,doc=new ActiveXObject("htmlfile"),unattach=function(){clearTimeout(tref)},cleanup=function(){doc&&(unattach(),utils.unload_del(unload_ref),iframe.parentNode.removeChild(iframe),iframe=doc=null,CollectGarbage())},onerror=function(r){doc&&(cleanup(),error_callback(r))},post=function(msg,origin){try{iframe&&iframe.contentWindow&&iframe.contentWindow.postMessage(msg,origin)}catch(x){}};doc.open(),doc.write('<html><script>document.domain="'+document.domain+'";</script></html>'),doc.close(),doc.parentWindow[WPrefix]=_window[WPrefix];var c=doc.createElement("div");return doc.body.appendChild(c),iframe=doc.createElement("iframe"),c.appendChild(iframe),iframe.src=iframe_url,tref=setTimeout(function(){onerror("timeout")},15e3),unload_ref=utils.unload_add(cleanup),{post:post,cleanup:cleanup,loaded:unattach}};var AbstractXHRObject=function(){};AbstractXHRObject.prototype=new EventEmitter(["chunk","finish"]),AbstractXHRObject.prototype._start=function(method,url,payload,opts){var that=this;try{that.xhr=new XMLHttpRequest}catch(x){}if(!that.xhr)try{that.xhr=new _window.ActiveXObject("Microsoft.XMLHTTP")}catch(x){}(_window.ActiveXObject||_window.XDomainRequest)&&(url+=(-1===url.indexOf("?")?"?":"&")+"t="+ +new Date),that.unload_ref=utils.unload_add(function(){that._cleanup(!0)});try{that.xhr.open(method,url,!0)}catch(e){return that.emit("finish",0,""),void that._cleanup()}if(opts&&opts.no_credentials||(that.xhr.withCredentials="true"),opts&&opts.headers)for(var key in opts.headers)that.xhr.setRequestHeader(key,opts.headers[key]);that.xhr.onreadystatechange=function(){if(that.xhr){var x=that.xhr;switch(x.readyState){case 3:try{var status=x.status,text=x.responseText}catch(x){}1223===status&&(status=204),text&&text.length>0&&that.emit("chunk",status,text);break;case 4:var status=x.status;1223===status&&(status=204),that.emit("finish",status,x.responseText),that._cleanup(!1)}}},that.xhr.send(payload)},AbstractXHRObject.prototype._cleanup=function(abort){var that=this;if(that.xhr){if(utils.unload_del(that.unload_ref),that.xhr.onreadystatechange=function(){},abort)try{that.xhr.abort()}catch(x){}that.unload_ref=that.xhr=null}},AbstractXHRObject.prototype.close=function(){var that=this;that.nuke(),that._cleanup(!0)};var XHRCorsObject=utils.XHRCorsObject=function(){var that=this,args=arguments;utils.delay(function(){that._start.apply(that,args)})};XHRCorsObject.prototype=new AbstractXHRObject;var XHRLocalObject=utils.XHRLocalObject=function(method,url,payload){var that=this;utils.delay(function(){that._start(method,url,payload,{no_credentials:!0})})};XHRLocalObject.prototype=new AbstractXHRObject;var XDRObject=utils.XDRObject=function(method,url,payload){var that=this;utils.delay(function(){that._start(method,url,payload)})};XDRObject.prototype=new EventEmitter(["chunk","finish"]),XDRObject.prototype._start=function(method,url,payload){var that=this,xdr=new XDomainRequest;url+=(-1===url.indexOf("?")?"?":"&")+"t="+ +new Date;var onerror=xdr.ontimeout=xdr.onerror=function(){that.emit("finish",0,""),that._cleanup(!1)};xdr.onprogress=function(){that.emit("chunk",200,xdr.responseText)},xdr.onload=function(){that.emit("finish",200,xdr.responseText),that._cleanup(!1)},that.xdr=xdr,that.unload_ref=utils.unload_add(function(){that._cleanup(!0)});try{that.xdr.open(method,url),that.xdr.send(payload)}catch(x){onerror()}},XDRObject.prototype._cleanup=function(abort){var that=this;if(that.xdr){if(utils.unload_del(that.unload_ref),that.xdr.ontimeout=that.xdr.onerror=that.xdr.onprogress=that.xdr.onload=null,abort)try{that.xdr.abort()}catch(x){}that.unload_ref=that.xdr=null}},XDRObject.prototype.close=function(){var that=this;that.nuke(),that._cleanup(!0)},utils.isXHRCorsCapable=function(){return _window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:_window.XDomainRequest&&_document.domain?2:IframeTransport.enabled()?3:4};var SockJS=function(url,dep_protocols_whitelist,options){if(this===_window)return new SockJS(url,dep_protocols_whitelist,options);var protocols_whitelist,that=this;that._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},options&&utils.objectExtend(that._options,options),that._base_url=utils.amendUrl(url),that._server=that._options.server||utils.random_number_string(1e3),that._options.protocols_whitelist&&that._options.protocols_whitelist.length?protocols_whitelist=that._options.protocols_whitelist:(protocols_whitelist="string"==typeof dep_protocols_whitelist&&dep_protocols_whitelist.length>0?[dep_protocols_whitelist]:utils.isArray(dep_protocols_whitelist)?dep_protocols_whitelist:null,protocols_whitelist&&that._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),that._protocols=[],that.protocol=null,that.readyState=SockJS.CONNECTING,that._ir=createInfoReceiver(that._base_url),that._ir.onfinish=function(info,rtt){that._ir=null,info?(that._options.info&&(info=utils.objectExtend(info,that._options.info)),that._options.rtt&&(rtt=that._options.rtt),that._applyInfo(info,rtt,protocols_whitelist),that._didClose()):that._didClose(1002,"Can't connect to server",!0)}};SockJS.prototype=new REventTarget,SockJS.version="0.3.4",SockJS.CONNECTING=0,SockJS.OPEN=1,SockJS.CLOSING=2,SockJS.CLOSED=3,SockJS.prototype._debug=function(){this._options.debug&&utils.log.apply(utils,arguments)},SockJS.prototype._dispatchOpen=function(){var that=this;that.readyState===SockJS.CONNECTING?(that._transport_tref&&(clearTimeout(that._transport_tref),that._transport_tref=null),that.readyState=SockJS.OPEN,that.dispatchEvent(new SimpleEvent("open"))):that._didClose(1006,"Server lost session")},SockJS.prototype._dispatchMessage=function(data){var that=this;that.readyState===SockJS.OPEN&&that.dispatchEvent(new SimpleEvent("message",{data:data}))},SockJS.prototype._dispatchHeartbeat=function(){var that=this;that.readyState===SockJS.OPEN&&that.dispatchEvent(new SimpleEvent("heartbeat",{}))},SockJS.prototype._didClose=function(code,reason,force){var that=this;if(that.readyState!==SockJS.CONNECTING&&that.readyState!==SockJS.OPEN&&that.readyState!==SockJS.CLOSING)throw new Error("INVALID_STATE_ERR");that._ir&&(that._ir.nuke(),that._ir=null),that._transport&&(that._transport.doCleanup(),that._transport=null);var close_event=new SimpleEvent("close",{code:code,reason:reason,wasClean:utils.userSetCode(code)});if(!utils.userSetCode(code)&&that.readyState===SockJS.CONNECTING&&!force){if(that._try_next_protocol(close_event))return;close_event=new SimpleEvent("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:close_event})}that.readyState=SockJS.CLOSED,utils.delay(function(){that.dispatchEvent(close_event)})},SockJS.prototype._didMessage=function(data){var that=this,type=data.slice(0,1);switch(type){case"o":that._dispatchOpen();break;case"a":for(var payload=JSON.parse(data.slice(1)||"[]"),i=0;i<payload.length;i++)that._dispatchMessage(payload[i]);break;case"m":var payload=JSON.parse(data.slice(1)||"null");that._dispatchMessage(payload);break;case"c":var payload=JSON.parse(data.slice(1)||"[]");that._didClose(payload[0],payload[1]);break;case"h":that._dispatchHeartbeat()}},SockJS.prototype._try_next_protocol=function(close_event){var that=this;for(that.protocol&&(that._debug("Closed transport:",that.protocol,""+close_event),that.protocol=null),that._transport_tref&&(clearTimeout(that._transport_tref),that._transport_tref=null);;){var protocol=that.protocol=that._protocols.shift();if(!protocol)return!1;if(SockJS[protocol]&&SockJS[protocol].need_body===!0&&(!_document.body||"undefined"!=typeof _document.readyState&&"complete"!==_document.readyState))return that._protocols.unshift(protocol),that.protocol="waiting-for-load",utils.attachEvent("load",function(){that._try_next_protocol()}),!0;if(SockJS[protocol]&&SockJS[protocol].enabled(that._options)){var roundTrips=SockJS[protocol].roundTrips||1,to=(that._options.rto||0)*roundTrips||5e3;that._transport_tref=utils.delay(to,function(){that.readyState===SockJS.CONNECTING&&that._didClose(2007,"Transport timeouted")});var connid=utils.random_string(8),trans_url=that._base_url+"/"+that._server+"/"+connid;return that._debug("Opening transport:",protocol," url:"+trans_url," RTO:"+that._options.rto),that._transport=new SockJS[protocol](that,trans_url,that._base_url),!0}that._debug("Skipping transport:",protocol)}},SockJS.prototype.close=function(code,reason){var that=this;if(code&&!utils.userSetCode(code))throw new Error("INVALID_ACCESS_ERR");return that.readyState!==SockJS.CONNECTING&&that.readyState!==SockJS.OPEN?!1:(that.readyState=SockJS.CLOSING,that._didClose(code||1e3,reason||"Normal closure"),!0)},SockJS.prototype.send=function(data){var that=this;if(that.readyState===SockJS.CONNECTING)throw new Error("INVALID_STATE_ERR");return that.readyState===SockJS.OPEN&&that._transport.doSend(utils.quote(""+data)),!0},SockJS.prototype._applyInfo=function(info,rtt,protocols_whitelist){var that=this;that._options.info=info,that._options.rtt=rtt,that._options.rto=utils.countRTO(rtt),that._options.info.null_origin=!_document.domain;var probed=utils.probeProtocols();that._protocols=utils.detectProtocols(probed,protocols_whitelist,info)};var WebSocketTransport=SockJS.websocket=function(ri,trans_url){var that=this,url=trans_url+"/websocket";url="https"===url.slice(0,5)?"wss"+url.slice(5):"ws"+url.slice(4),that.ri=ri,that.url=url;var Constructor=_window.WebSocket||_window.MozWebSocket;that.ws=new Constructor(that.url),that.ws.onmessage=function(e){that.ri._didMessage(e.data)},that.unload_ref=utils.unload_add(function(){that.ws.close()}),that.ws.onclose=function(){that.ri._didMessage(utils.closeFrame(1006,"WebSocket connection broken"))}};WebSocketTransport.prototype.doSend=function(data){this.ws.send("["+data+"]")},WebSocketTransport.prototype.doCleanup=function(){var that=this,ws=that.ws;ws&&(ws.onmessage=ws.onclose=null,ws.close(),utils.unload_del(that.unload_ref),that.unload_ref=that.ri=that.ws=null)},WebSocketTransport.enabled=function(){return!(!_window.WebSocket&&!_window.MozWebSocket)},WebSocketTransport.roundTrips=2;var BufferedSender=function(){};BufferedSender.prototype.send_constructor=function(sender){var that=this;that.send_buffer=[],that.sender=sender},BufferedSender.prototype.doSend=function(message){var that=this;that.send_buffer.push(message),that.send_stop||that.send_schedule()},BufferedSender.prototype.send_schedule_wait=function(){var tref,that=this;that.send_stop=function(){that.send_stop=null,clearTimeout(tref)},tref=utils.delay(25,function(){that.send_stop=null,that.send_schedule()})},BufferedSender.prototype.send_schedule=function(){var that=this;if(that.send_buffer.length>0){var payload="["+that.send_buffer.join(",")+"]";that.send_stop=that.sender(that.trans_url,payload,function(success,abort_reason){that.send_stop=null,success===!1?that.ri._didClose(1006,"Sending error "+abort_reason):that.send_schedule_wait()}),that.send_buffer=[]}},BufferedSender.prototype.send_destructor=function(){var that=this;that._send_stop&&that._send_stop(),that._send_stop=null};var jsonPGenericSender=function(url,payload,callback){var that=this;if(!("_send_form"in that)){var form=that._send_form=_document.createElement("form"),area=that._send_area=_document.createElement("textarea");area.name="d",form.style.display="none",form.style.position="absolute",form.method="POST",form.enctype="application/x-www-form-urlencoded",form.acceptCharset="UTF-8",form.appendChild(area),_document.body.appendChild(form)}var form=that._send_form,area=that._send_area,id="a"+utils.random_string(8);form.target=id,form.action=url+"/jsonp_send?i="+id;var iframe;try{iframe=_document.createElement('<iframe name="'+id+'">')}catch(x){iframe=_document.createElement("iframe"),iframe.name=id}iframe.id=id,form.appendChild(iframe),iframe.style.display="none";try{area.value=payload}catch(e){utils.log("Your browser is seriously broken. Go home! "+e.message)}form.submit();var completed=function(){iframe.onerror&&(iframe.onreadystatechange=iframe.onerror=iframe.onload=null,utils.delay(500,function(){iframe.parentNode.removeChild(iframe),iframe=null}),area.value="",callback(!0))};return iframe.onerror=iframe.onload=completed,iframe.onreadystatechange=function(){"complete"==iframe.readyState&&completed()},completed},createAjaxSender=function(AjaxObject){return function(url,payload,callback){var xo=new AjaxObject("POST",url+"/xhr_send",payload);return xo.onfinish=function(status){callback(200===status||204===status,"http status "+status)},function(abort_reason){callback(!1,abort_reason)}}},jsonPGenericReceiver=function(url,callback){var tref,script2,script=_document.createElement("script"),close_script=function(frame){script2&&(script2.parentNode.removeChild(script2),script2=null),script&&(clearTimeout(tref),script.parentNode.removeChild(script),script.onreadystatechange=script.onerror=script.onload=script.onclick=null,script=null,callback(frame),callback=null)},loaded_okay=!1,error_timer=null;if(script.id="a"+utils.random_string(8),script.src=url,script.type="text/javascript",script.charset="UTF-8",script.onerror=function(){error_timer||(error_timer=setTimeout(function(){loaded_okay||close_script(utils.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},script.onload=function(){close_script(utils.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},script.onreadystatechange=function(){if(/loaded|closed/.test(script.readyState)){if(script&&script.htmlFor&&script.onclick){loaded_okay=!0;try{script.onclick()}catch(x){}}script&&close_script(utils.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof script.async&&_document.attachEvent)if(/opera/i.test(navigator.userAgent))script2=_document.createElement("script"),script2.text="try{var a = document.getElementById('"+script.id+"'); if(a)a.onerror();}catch(x){};",script.async=script2.async=!1;else{try{script.htmlFor=script.id,script.event="onclick"}catch(x){}script.async=!0}"undefined"!=typeof script.async&&(script.async=!0),tref=setTimeout(function(){close_script(utils.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var head=_document.getElementsByTagName("head")[0];return head.insertBefore(script,head.firstChild),script2&&head.insertBefore(script2,head.firstChild),close_script},JsonPTransport=SockJS["jsonp-polling"]=function(ri,trans_url){utils.polluteGlobalNamespace();var that=this;that.ri=ri,that.trans_url=trans_url,that.send_constructor(jsonPGenericSender),that._schedule_recv()};JsonPTransport.prototype=new BufferedSender,JsonPTransport.prototype._schedule_recv=function(){var that=this,callback=function(data){that._recv_stop=null,data&&(that._is_closing||that.ri._didMessage(data)),that._is_closing||that._schedule_recv()};that._recv_stop=jsonPReceiverWrapper(that.trans_url+"/jsonp",jsonPGenericReceiver,callback)},JsonPTransport.enabled=function(){return!0},JsonPTransport.need_body=!0,JsonPTransport.prototype.doCleanup=function(){var that=this;that._is_closing=!0,that._recv_stop&&that._recv_stop(),that.ri=that._recv_stop=null,that.send_destructor()};var jsonPReceiverWrapper=function(url,constructReceiver,user_callback){var id="a"+utils.random_string(6),url_id=url+"?c="+escape(WPrefix+"."+id),aborting=0,callback=function(frame){switch(aborting){case 0:delete _window[WPrefix][id],user_callback(frame);break;case 1:user_callback(frame),aborting=2;break;case 2:delete _window[WPrefix][id]}},close_script=constructReceiver(url_id,callback);_window[WPrefix][id]=close_script;var stop=function(){_window[WPrefix][id]&&(aborting=1,_window[WPrefix][id](utils.closeFrame(1e3,"JSONP user aborted read")))};return stop},AjaxBasedTransport=function(){};AjaxBasedTransport.prototype=new BufferedSender,AjaxBasedTransport.prototype.run=function(ri,trans_url,url_suffix,Receiver,AjaxObject){var that=this;that.ri=ri,that.trans_url=trans_url,that.send_constructor(createAjaxSender(AjaxObject)),that.poll=new Polling(ri,Receiver,trans_url+url_suffix,AjaxObject)},AjaxBasedTransport.prototype.doCleanup=function(){var that=this;that.poll&&(that.poll.abort(),that.poll=null)};var XhrStreamingTransport=SockJS["xhr-streaming"]=function(ri,trans_url){this.run(ri,trans_url,"/xhr_streaming",XhrReceiver,utils.XHRCorsObject)};XhrStreamingTransport.prototype=new AjaxBasedTransport,XhrStreamingTransport.enabled=function(){return _window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},XhrStreamingTransport.roundTrips=2,XhrStreamingTransport.need_body=!0;var XdrStreamingTransport=SockJS["xdr-streaming"]=function(ri,trans_url){this.run(ri,trans_url,"/xhr_streaming",XhrReceiver,utils.XDRObject)};XdrStreamingTransport.prototype=new AjaxBasedTransport,XdrStreamingTransport.enabled=function(){return!!_window.XDomainRequest},XdrStreamingTransport.roundTrips=2;var XhrPollingTransport=SockJS["xhr-polling"]=function(ri,trans_url){this.run(ri,trans_url,"/xhr",XhrReceiver,utils.XHRCorsObject)};XhrPollingTransport.prototype=new AjaxBasedTransport,XhrPollingTransport.enabled=XhrStreamingTransport.enabled,XhrPollingTransport.roundTrips=2;
var XdrPollingTransport=SockJS["xdr-polling"]=function(ri,trans_url){this.run(ri,trans_url,"/xhr",XhrReceiver,utils.XDRObject)};XdrPollingTransport.prototype=new AjaxBasedTransport,XdrPollingTransport.enabled=XdrStreamingTransport.enabled,XdrPollingTransport.roundTrips=2;var IframeTransport=function(){};IframeTransport.prototype.i_constructor=function(ri,trans_url,base_url){var that=this;that.ri=ri,that.origin=utils.getOrigin(base_url),that.base_url=base_url,that.trans_url=trans_url;var iframe_url=base_url+"/iframe.html";that.ri._options.devel&&(iframe_url+="?t="+ +new Date),that.window_id=utils.random_string(8),iframe_url+="#"+that.window_id,that.iframeObj=utils.createIframe(iframe_url,function(r){that.ri._didClose(1006,"Unable to load an iframe ("+r+")")}),that.onmessage_cb=utils.bind(that.onmessage,that),utils.attachMessage(that.onmessage_cb)},IframeTransport.prototype.doCleanup=function(){var that=this;if(that.iframeObj){utils.detachMessage(that.onmessage_cb);try{that.iframeObj.iframe.contentWindow&&that.postMessage("c")}catch(x){}that.iframeObj.cleanup(),that.iframeObj=null,that.onmessage_cb=that.iframeObj=null}},IframeTransport.prototype.onmessage=function(e){var that=this;if(e.origin===that.origin){var window_id=e.data.slice(0,8),type=e.data.slice(8,9),data=e.data.slice(9);if(window_id===that.window_id)switch(type){case"s":that.iframeObj.loaded(),that.postMessage("s",JSON.stringify([SockJS.version,that.protocol,that.trans_url,that.base_url]));break;case"t":that.ri._didMessage(data)}}},IframeTransport.prototype.postMessage=function(type,data){var that=this;that.iframeObj.post(that.window_id+type+(data||""),that.origin)},IframeTransport.prototype.doSend=function(message){this.postMessage("m",message)},IframeTransport.enabled=function(){var konqueror=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof _window.postMessage||"object"==typeof _window.postMessage)&&!konqueror};var curr_window_id,postMessage=function(type,data){parent!==_window?parent.postMessage(curr_window_id+type+(data||""),"*"):utils.log("Can't postMessage, no parent window.",type,data)},FacadeJS=function(){};FacadeJS.prototype._didClose=function(code,reason){postMessage("t",utils.closeFrame(code,reason))},FacadeJS.prototype._didMessage=function(frame){postMessage("t",frame)},FacadeJS.prototype._doSend=function(data){this._transport.doSend(data)},FacadeJS.prototype._doCleanup=function(){this._transport.doCleanup()},utils.parent_origin=void 0,SockJS.bootstrap_iframe=function(){var facade;curr_window_id=_document.location.hash.slice(1);var onMessage=function(e){if(e.source===parent&&("undefined"==typeof utils.parent_origin&&(utils.parent_origin=e.origin),e.origin===utils.parent_origin)){var window_id=e.data.slice(0,8),type=e.data.slice(8,9),data=e.data.slice(9);if(window_id===curr_window_id)switch(type){case"s":var p=JSON.parse(data),version=p[0],protocol=p[1],trans_url=p[2],base_url=p[3];if(version!==SockJS.version&&utils.log('Incompatibile SockJS! Main site uses: "'+version+'", the iframe: "'+SockJS.version+'".'),!utils.flatUrl(trans_url)||!utils.flatUrl(base_url))return void utils.log("Only basic urls are supported in SockJS");if(!utils.isSameOriginUrl(trans_url)||!utils.isSameOriginUrl(base_url))return void utils.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([_window.location.href,trans_url,base_url])+")");facade=new FacadeJS,facade._transport=new FacadeJS[protocol](facade,trans_url,base_url);break;case"m":facade._doSend(data);break;case"c":facade&&facade._doCleanup(),facade=null}}};utils.attachMessage(onMessage),postMessage("s")};var InfoReceiver=function(base_url,AjaxObject){var that=this;utils.delay(function(){that.doXhr(base_url,AjaxObject)})};InfoReceiver.prototype=new EventEmitter(["finish"]),InfoReceiver.prototype.doXhr=function(base_url,AjaxObject){var that=this,t0=(new Date).getTime(),xo=new AjaxObject("GET",base_url+"/info"),tref=utils.delay(8e3,function(){xo.ontimeout()});xo.onfinish=function(status,text){if(clearTimeout(tref),tref=null,200===status){var rtt=(new Date).getTime()-t0,info=JSON.parse(text);"object"!=typeof info&&(info={}),that.emit("finish",info,rtt)}else that.emit("finish")},xo.ontimeout=function(){xo.close(),that.emit("finish")}};var InfoReceiverIframe=function(base_url){var that=this,go=function(){var ifr=new IframeTransport;ifr.protocol="w-iframe-info-receiver";var fun=function(r){if("string"==typeof r&&"m"===r.substr(0,1)){var d=JSON.parse(r.substr(1)),info=d[0],rtt=d[1];that.emit("finish",info,rtt)}else that.emit("finish");ifr.doCleanup(),ifr=null},mock_ri={_options:{},_didClose:fun,_didMessage:fun};ifr.i_constructor(mock_ri,base_url,base_url)};_document.body?go():utils.attachEvent("load",go)};InfoReceiverIframe.prototype=new EventEmitter(["finish"]);var InfoReceiverFake=function(){var that=this;utils.delay(function(){that.emit("finish",{},2e3)})};InfoReceiverFake.prototype=new EventEmitter(["finish"]);var createInfoReceiver=function(base_url){if(utils.isSameOriginUrl(base_url))return new InfoReceiver(base_url,utils.XHRLocalObject);switch(utils.isXHRCorsCapable()){case 1:return new InfoReceiver(base_url,utils.XHRLocalObject);case 2:return new InfoReceiver(base_url,utils.XDRObject);case 3:return new InfoReceiverIframe(base_url);default:return new InfoReceiverFake}},WInfoReceiverIframe=FacadeJS["w-iframe-info-receiver"]=function(ri,_trans_url,base_url){var ir=new InfoReceiver(base_url,utils.XHRLocalObject);ir.onfinish=function(info,rtt){ri._didMessage("m"+JSON.stringify([info,rtt])),ri._didClose()}};WInfoReceiverIframe.prototype.doCleanup=function(){};var EventSourceIframeTransport=SockJS["iframe-eventsource"]=function(){var that=this;that.protocol="w-iframe-eventsource",that.i_constructor.apply(that,arguments)};EventSourceIframeTransport.prototype=new IframeTransport,EventSourceIframeTransport.enabled=function(){return"EventSource"in _window&&IframeTransport.enabled()},EventSourceIframeTransport.need_body=!0,EventSourceIframeTransport.roundTrips=3;var EventSourceTransport=FacadeJS["w-iframe-eventsource"]=function(ri,trans_url){this.run(ri,trans_url,"/eventsource",EventSourceReceiver,utils.XHRLocalObject)};EventSourceTransport.prototype=new AjaxBasedTransport;var XhrPollingIframeTransport=SockJS["iframe-xhr-polling"]=function(){var that=this;that.protocol="w-iframe-xhr-polling",that.i_constructor.apply(that,arguments)};XhrPollingIframeTransport.prototype=new IframeTransport,XhrPollingIframeTransport.enabled=function(){return _window.XMLHttpRequest&&IframeTransport.enabled()},XhrPollingIframeTransport.need_body=!0,XhrPollingIframeTransport.roundTrips=3;var XhrPollingITransport=FacadeJS["w-iframe-xhr-polling"]=function(ri,trans_url){this.run(ri,trans_url,"/xhr",XhrReceiver,utils.XHRLocalObject)};XhrPollingITransport.prototype=new AjaxBasedTransport;var HtmlFileIframeTransport=SockJS["iframe-htmlfile"]=function(){var that=this;that.protocol="w-iframe-htmlfile",that.i_constructor.apply(that,arguments)};HtmlFileIframeTransport.prototype=new IframeTransport,HtmlFileIframeTransport.enabled=function(){return IframeTransport.enabled()},HtmlFileIframeTransport.need_body=!0,HtmlFileIframeTransport.roundTrips=3;var HtmlFileTransport=FacadeJS["w-iframe-htmlfile"]=function(ri,trans_url){this.run(ri,trans_url,"/htmlfile",HtmlfileReceiver,utils.XHRLocalObject)};HtmlFileTransport.prototype=new AjaxBasedTransport;var Polling=function(ri,Receiver,recv_url,AjaxObject){var that=this;that.ri=ri,that.Receiver=Receiver,that.recv_url=recv_url,that.AjaxObject=AjaxObject,that._scheduleRecv()};Polling.prototype._scheduleRecv=function(){var that=this,poll=that.poll=new that.Receiver(that.recv_url,that.AjaxObject),msg_counter=0;poll.onmessage=function(e){msg_counter+=1,that.ri._didMessage(e.data)},poll.onclose=function(e){that.poll=poll=poll.onmessage=poll.onclose=null,that.poll_is_closing||("permanent"===e.reason?that.ri._didClose(1006,"Polling error ("+e.reason+")"):that._scheduleRecv())}},Polling.prototype.abort=function(){var that=this;that.poll_is_closing=!0,that.poll&&that.poll.abort()};var EventSourceReceiver=function(url){var that=this,es=new EventSource(url);es.onmessage=function(e){that.dispatchEvent(new SimpleEvent("message",{data:unescape(e.data)}))},that.es_close=es.onerror=function(e,abort_reason){var reason=abort_reason?"user":2!==es.readyState?"network":"permanent";that.es_close=es.onmessage=es.onerror=null,es.close(),es=null,utils.delay(200,function(){that.dispatchEvent(new SimpleEvent("close",{reason:reason}))})}};EventSourceReceiver.prototype=new REventTarget,EventSourceReceiver.prototype.abort=function(){var that=this;that.es_close&&that.es_close({},!0)};var _is_ie_htmlfile_capable,isIeHtmlfileCapable=function(){if(void 0===_is_ie_htmlfile_capable)if("ActiveXObject"in _window)try{_is_ie_htmlfile_capable=!!new ActiveXObject("htmlfile")}catch(x){}else _is_ie_htmlfile_capable=!1;return _is_ie_htmlfile_capable},HtmlfileReceiver=function(url){var that=this;utils.polluteGlobalNamespace(),that.id="a"+utils.random_string(6,26),url+=(-1===url.indexOf("?")?"?":"&")+"c="+escape(WPrefix+"."+that.id);var iframeObj,constructor=isIeHtmlfileCapable()?utils.createHtmlfile:utils.createIframe;_window[WPrefix][that.id]={start:function(){iframeObj.loaded()},message:function(data){that.dispatchEvent(new SimpleEvent("message",{data:data}))},stop:function(){that.iframe_close({},"network")}},that.iframe_close=function(e,abort_reason){iframeObj.cleanup(),that.iframe_close=iframeObj=null,delete _window[WPrefix][that.id],that.dispatchEvent(new SimpleEvent("close",{reason:abort_reason}))},iframeObj=constructor(url,function(){that.iframe_close({},"permanent")})};HtmlfileReceiver.prototype=new REventTarget,HtmlfileReceiver.prototype.abort=function(){var that=this;that.iframe_close&&that.iframe_close({},"user")};var XhrReceiver=function(url,AjaxObject){var that=this,buf_pos=0;that.xo=new AjaxObject("POST",url,null),that.xo.onchunk=function(status,text){if(200===status)for(;;){var buf=text.slice(buf_pos),p=buf.indexOf("\n");if(-1===p)break;buf_pos+=p+1;var msg=buf.slice(0,p);that.dispatchEvent(new SimpleEvent("message",{data:msg}))}},that.xo.onfinish=function(status,text){that.xo.onchunk(status,text),that.xo=null;var reason=200===status?"network":"permanent";that.dispatchEvent(new SimpleEvent("close",{reason:reason}))}};return XhrReceiver.prototype=new REventTarget,XhrReceiver.prototype.abort=function(){var that=this;that.xo&&(that.xo.close(),that.dispatchEvent(new SimpleEvent("close",{reason:"user"})),that.xo=null)},SockJS.getUtils=function(){return utils},SockJS.getIframeTransport=function(){return IframeTransport},SockJS}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),function(){var Byte,Client,Frame,Stomp,__hasProp={}.hasOwnProperty,__slice=[].slice;Byte={LF:"\n",NULL:"\x00"},Frame=function(){function Frame(command,headers,body){this.command=command,this.headers=null!=headers?headers:{},this.body=null!=body?body:""}var unmarshallSingle;return Frame.prototype.toString=function(){var lines,name,value,_ref;lines=[this.command],_ref=this.headers;for(name in _ref)__hasProp.call(_ref,name)&&(value=_ref[name],lines.push(""+name+":"+value));return this.body&&lines.push("content-length:"+Frame.sizeOfUTF8(this.body)),lines.push(Byte.LF+this.body),lines.join(Byte.LF)},Frame.sizeOfUTF8=function(s){return s?encodeURI(s).split(/%..|./).length-1:0},unmarshallSingle=function(data){var body,chr,command,divider,headerLines,headers,i,idx,len,line,start,trim,_i,_j,_len,_ref,_ref1;for(divider=data.search(RegExp(""+Byte.LF+Byte.LF)),headerLines=data.substring(0,divider).split(Byte.LF),command=headerLines.shift(),headers={},trim=function(str){return str.replace(/^\s+|\s+$/g,"")},_ref=headerLines.reverse(),_i=0,_len=_ref.length;_len>_i;_i++)line=_ref[_i],idx=line.indexOf(":"),headers[trim(line.substring(0,idx))]=trim(line.substring(idx+1));if(body="",start=divider+2,headers["content-length"])len=parseInt(headers["content-length"]),body=(""+data).substring(start,start+len);else for(chr=null,i=_j=start,_ref1=data.length;(_ref1>=start?_ref1>_j:_j>_ref1)&&(chr=data.charAt(i),chr!==Byte.NULL);i=_ref1>=start?++_j:--_j)body+=chr;return new Frame(command,headers,body)},Frame.unmarshall=function(datas){var data;return function(){var _i,_len,_ref,_results;for(_ref=datas.split(RegExp(""+Byte.NULL+Byte.LF+"*")),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)data=_ref[_i],(null!=data?data.length:void 0)>0&&_results.push(unmarshallSingle(data));return _results}()},Frame.marshall=function(command,headers,body){var frame;return frame=new Frame(command,headers,body),frame.toString()+Byte.NULL},Frame}(),Client=function(){function Client(ws){this.ws=ws,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}var now;return Client.prototype.debug=function(message){var _ref;return"undefined"!=typeof window&&null!==window&&null!=(_ref=window.console)?_ref.log(message):void 0},now=function(){return Date.now||(new Date).valueOf},Client.prototype._transmit=function(command,headers,body){var out;for(out=Frame.marshall(command,headers,body),"function"==typeof this.debug&&this.debug(">>> "+out);;){if(!(out.length>this.maxWebSocketFrameSize))return this.ws.send(out);this.ws.send(out.substring(0,this.maxWebSocketFrameSize)),out=out.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+out.length)}},Client.prototype._setupHeartbeat=function(headers){var serverIncoming,serverOutgoing,ttl,v,_ref,_ref1,_this=this;if((_ref=headers.version)===Stomp.VERSIONS.V1_1||_ref===Stomp.VERSIONS.V1_2)return _ref1=function(){var _i,_len,_ref1,_results;for(_ref1=headers["heart-beat"].split(","),_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)v=_ref1[_i],_results.push(parseInt(v));return _results}(),serverOutgoing=_ref1[0],serverIncoming=_ref1[1],0!==this.heartbeat.outgoing&&0!==serverIncoming&&(ttl=Math.max(this.heartbeat.outgoing,serverIncoming),"function"==typeof this.debug&&this.debug("send PING every "+ttl+"ms"),this.pinger=Stomp.setInterval(ttl,function(){return _this.ws.send(Byte.LF),"function"==typeof _this.debug?_this.debug(">>> PING"):void 0})),0!==this.heartbeat.incoming&&0!==serverOutgoing?(ttl=Math.max(this.heartbeat.incoming,serverOutgoing),"function"==typeof this.debug&&this.debug("check PONG every "+ttl+"ms"),this.ponger=Stomp.setInterval(ttl,function(){var delta;return delta=now()-_this.serverActivity,delta>2*ttl?("function"==typeof _this.debug&&_this.debug("did not receive server activity for the last "+delta+"ms"),_this.ws.close()):void 0})):void 0},Client.prototype._parseConnect=function(){var args,connectCallback,errorCallback,headers;switch(args=1<=arguments.length?__slice.call(arguments,0):[],headers={},args.length){case 2:headers=args[0],connectCallback=args[1];break;case 3:args[1]instanceof Function?(headers=args[0],connectCallback=args[1],errorCallback=args[2]):(headers.login=args[0],headers.passcode=args[1],connectCallback=args[2]);break;case 4:headers.login=args[0],headers.passcode=args[1],connectCallback=args[2],errorCallback=args[3];break;default:headers.login=args[0],headers.passcode=args[1],connectCallback=args[2],errorCallback=args[3],headers.host=args[4]}return[headers,connectCallback,errorCallback]},Client.prototype.connect=function(){var args,errorCallback,headers,out,_this=this;return args=1<=arguments.length?__slice.call(arguments,0):[],out=this._parseConnect.apply(this,args),headers=out[0],this.connectCallback=out[1],errorCallback=out[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(evt){var arr,c,client,data,frame,messageID,onreceive,subscription,_i,_len,_ref,_results;if(data="undefined"!=typeof ArrayBuffer&&evt.data instanceof ArrayBuffer?(arr=new Uint8Array(evt.data),"function"==typeof _this.debug?_this.debug("--- got data length: "+arr.length):void 0,function(){var _i,_len,_results;for(_results=[],_i=0,_len=arr.length;_len>_i;_i++)c=arr[_i],_results.push(String.fromCharCode(c));return _results}().join("")):evt.data,_this.serverActivity=now(),data===Byte.LF)return void("function"==typeof _this.debug&&_this.debug("<<< PONG"));for("function"==typeof _this.debug&&_this.debug("<<< "+data),_ref=Frame.unmarshall(data),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)switch(frame=_ref[_i],frame.command){case"CONNECTED":"function"==typeof _this.debug&&_this.debug("connected to server "+frame.headers.server),_this.connected=!0,_this._setupHeartbeat(frame.headers),_results.push("function"==typeof _this.connectCallback?_this.connectCallback(frame):void 0);break;case"MESSAGE":subscription=frame.headers.subscription,onreceive=_this.subscriptions[subscription]||_this.onreceive,onreceive?(client=_this,messageID=frame.headers["message-id"],frame.ack=function(headers){return null==headers&&(headers={}),client.ack(messageID,subscription,headers)},frame.nack=function(headers){return null==headers&&(headers={}),client.nack(messageID,subscription,headers)},_results.push(onreceive(frame))):_results.push("function"==typeof _this.debug?_this.debug("Unhandled received MESSAGE: "+frame):void 0);break;case"RECEIPT":_results.push("function"==typeof _this.onreceipt?_this.onreceipt(frame):void 0);break;case"ERROR":_results.push("function"==typeof errorCallback?errorCallback(frame):void 0);break;default:_results.push("function"==typeof _this.debug?_this.debug("Unhandled frame: "+frame):void 0)}return _results},this.ws.onclose=function(){var msg;return msg="Whoops! Lost connection to "+_this.ws.url,"function"==typeof _this.debug&&_this.debug(msg),_this._cleanUp(),"function"==typeof errorCallback?errorCallback(msg):void 0},this.ws.onopen=function(){return"function"==typeof _this.debug&&_this.debug("Web Socket Opened..."),headers["accept-version"]=Stomp.VERSIONS.supportedVersions(),headers["heart-beat"]=[_this.heartbeat.outgoing,_this.heartbeat.incoming].join(","),_this._transmit("CONNECT",headers)}},Client.prototype.disconnect=function(disconnectCallback){return this._transmit("DISCONNECT"),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof disconnectCallback?disconnectCallback():void 0},Client.prototype._cleanUp=function(){return this.connected=!1,this.pinger&&Stomp.clearInterval(this.pinger),this.ponger?Stomp.clearInterval(this.ponger):void 0},Client.prototype.send=function(destination,headers,body){return null==headers&&(headers={}),null==body&&(body=""),headers.destination=destination,this._transmit("SEND",headers,body)},Client.prototype.subscribe=function(destination,callback,headers){var client;return null==headers&&(headers={}),headers.id||(headers.id="sub-"+this.counter++),headers.destination=destination,this.subscriptions[headers.id]=callback,this._transmit("SUBSCRIBE",headers),client=this,{id:headers.id,unsubscribe:function(){return client.unsubscribe(headers.id)}}},Client.prototype.unsubscribe=function(id){return delete this.subscriptions[id],this._transmit("UNSUBSCRIBE",{id:id})},Client.prototype.begin=function(transaction){var client,txid;return txid=transaction||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:txid}),client=this,{id:txid,commit:function(){return client.commit(txid)},abort:function(){return client.abort(txid)}}},Client.prototype.commit=function(transaction){return this._transmit("COMMIT",{transaction:transaction})},Client.prototype.abort=function(transaction){return this._transmit("ABORT",{transaction:transaction})},Client.prototype.ack=function(messageID,subscription,headers){return null==headers&&(headers={}),headers["message-id"]=messageID,headers.subscription=subscription,this._transmit("ACK",headers)},Client.prototype.nack=function(messageID,subscription,headers){return null==headers&&(headers={}),headers["message-id"]=messageID,headers.subscription=subscription,this._transmit("NACK",headers)},Client}(),Stomp={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(url,protocols){var klass,ws;return null==protocols&&(protocols=["v10.stomp","v11.stomp"]),klass=Stomp.WebSocketClass||WebSocket,ws=new klass(url,protocols),new Client(ws)},over:function(ws){return new Client(ws)},Frame:Frame},"undefined"!=typeof window&&null!==window?(Stomp.setInterval=function(interval,f){return window.setInterval(f,interval)},Stomp.clearInterval=function(id){return window.clearInterval(id)},window.Stomp=Stomp):"undefined"!=typeof exports&&null!==exports?exports.Stomp=Stomp:self.Stomp=Stomp}.call(this);